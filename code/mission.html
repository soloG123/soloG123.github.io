<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
    <title>Mission Briefing</title>
    <audio id="preloader" preload="auto" src="evil_laugh.mp3" style="display:none;"></audio>
</head>
<body class="orbitron-normal" style="background-color: black;">
    <div id="container">
        <div class="issue-brief centered-issue">
            <p id="issue-text"></p>
        </div>

        <div class="storybox2 mission-layer" id="mission-box" style="opacity: 0;">
            <h2 style="color: white; margin-bottom: 20px; font-size: 3em;">YOUR MISSION:</h2>
            <p id="mission-text" style="font-size: 1.6rem; min-height: 100px; color: white; margin-bottom: 50px;"></p>
            
            <nav id="next-btn" style="display: none; cursor: pointer;" onclick="acceptMission()">
                <p>ACCEPT MISSION</p>
            </nav>
        </div>

        <div class="video-background">
            <video autoplay muted loop id="myVideo">
                <source src="skull_bg.mp4" type="video/mp4">
            </video>
        </div>
    </div>

    <script>
    const issueBrief = "UNUSUAL SPIKE IN SYNTHETIC ACTIVITY DETECTED. NEURAL NETWORKS REPORT 87% ANOMALY RATE IN SECTOR 7. IMMEDIATE INTERVENTION REQUIRED.";
    const missionBrief = "Head to 235 Smith Street, New York to investigate an unusual spike in synthetic activity.";
    
    // --- AUDIO SETUP ---
    const typingSound = new Audio('type-sfx.wav');
    typingSound.loop = true;
    typingSound.volume = 0.1; // 1. LOWERED VOLUME (Set between 0.0 and 1.0)

    const laughSound = new Audio('skull_laugh.wav');
    const alarmSound = new Audio('alert-sfx.wav');
    alarmSound.volume = 0.1;
    const clickSound = new Audio('accept-sfx.wav'); // 2. LOAD CLICK SOUND
    
    let j = 0;
    let k = 0;

    window.onload = () => {
        setTimeout(() => {
            laughSound.play().catch(e => console.log("Audio play failed:", e));
        }, 600);
        setTimeout(() => {
            typeIssue();
            typingSound.play().catch(e => console.log("Audio play failed:", e));
        }, 2000); 
    };

    function typeIssue() {
        if (j < issueBrief.length) {
            document.getElementById("issue-text").textContent += issueBrief.charAt(j);
            j++;
            setTimeout(typeIssue, 25);
        } else {
            typingSound.pause();
            setTimeout(() => {
                const box = document.getElementById("mission-box");
                const missionText = document.getElementById("mission-text");
                const btn = document.getElementById('next-btn');

                // Set text directly
                missionText.textContent = missionBrief;

                // Apply the animation class
                box.classList.add('mission-alert-active');
                
                if (typeof alarmSound !== 'undefined') {
                    alarmSound.volume = 0.5; // Optional: Adjust alarm volume too
                    alarmSound.play().catch(e => console.log("Audio blocked"));
                }

                btn.style.display = "inline-block";
            }, 1000);
        }
    }

    // 3. NEW FUNCTION FOR CLICK SOUND + NAVIGATION
    function acceptMission() {
        clickSound.play(); // Play the sound
        
        // Wait 300ms for sound to be heard, then go to next page
        setTimeout(() => {
            window.location.href = 'familiarisation.html';
        }, 300);
    }
</script>
</body>
</html>